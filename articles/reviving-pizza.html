<!DOCTYPE html><html><head><meta charset="utf-8" /><meta name="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.css" /><link rel="stylesheet" href="/static/css/style_28d0663040790cd23ff0c2e10c66384d.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" crossorigin="anonymous" /><title>Coding with Pizza in 2024 | bishabosha</title><meta name="description" content="An experiment to try Pizza language in 2024, will it run?" /><meta name="twitter:card" content="summary" /><meta name="twitter:title" content="Coding with Pizza in 2024 | bishabosha" /><meta name="twitter:site" content="@bishabosha" /><meta name="twitter:description" content="An experiment to try Pizza language in 2024, will it run?" /><meta name="og:title" content="Coding with Pizza in 2024 | bishabosha" /><meta name="og:description" content="An experiment to try Pizza language in 2024, will it run?" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" /><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js" type="text/javascript"></script><link rel="stylesheet" href="/static/css/admonition_972c50a2320249eebf61150270d503dc.css" /></head><body class="d-flex flex-column min-vh-100"><nav class="navbar navbar-expand-md navbar-light fixed-top bg-light"><div class="container-fluid"><a class="navbar-brand navbar-slash" href="/">bishabosha</a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/about/">About</a></li><li class="nav-item"><a class="nav-link active" aria-current="page" href="/articles/">Articles</a></li><li class="nav-item"><a class="nav-link" href="/projects/">Projects</a></li><li class="nav-item"><a class="nav-link" href="/talks/">Talks</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-lg-4"><div class="bio-box jumbotron sidebar shadow py-lg-4 py-3 bio-box__top"><div class="bio-main"><table><tr><td class="bio-left"><div class="bio-photo"><img src="/static/img/jamie_thompson_profile.png" alt="photo of bishabosha" class="img-avatar" /></div></td><td class="bio-right"><p><span class="bio-name">Jamie Thompson</span></p></td></tr></table><ul class="list-inline"><li class="list-inline-item"><p class="text-center mb-1"><small><a href="mailto:jamie.thompson@bath.edu" class="bio-link"><i class="fa-solid fa-envelope fa-lg"></i><br />E-Mail</a></small></p></li><li class="list-inline-item"><p class="text-center mb-1"><small><a href="https://github.com/bishabosha" class="bio-link" rel="me"><i class="fa-brands fa-github fa-lg"></i><br />GitHub</a></small></p></li><li class="list-inline-item"><p class="text-center mb-1"><small><a href="https://twitter.com/bishabosha" class="bio-link" rel="me"><i class="fa-brands fa-twitter fa-lg"></i><br />Twitter</a></small></p></li><li class="list-inline-item"><p class="text-center mb-1"><small><a href="https://www.linkedin.com/in/james-richard-thompson/" class="bio-link" rel="me"><i class="fa-brands fa-linkedin fa-lg"></i><br />LinkedIn</a></small></p></li><li class="list-inline-item"><p class="text-center mb-1"><small><a href="https://fosstodon.org/@jrthompson" class="bio-link" rel="me"><i class="fa-brands fa-mastodon fa-lg"></i><br />Mastodon</a></small></p></li></ul><div class="d-none d-sm-none d-lg-block"><hr /><div class="bio-body bio-expand" tabindex="0"><p>Compiler hacker. This is an archive for my thoughts on programming, past and future.</p>
<p>Also a place to gather all the links.</p>
<p><a href="https://jamie-thompson-dev.github.io/"><strong>professional enquiries</strong></a>.</p>
</div></div></div></div><div id="sidebar-anchor" class="sticky-top top-aligned jumbotron sidebar sidebar__mobile shadow py-lg-4 py-3"><div id="sidebar-toggler" class="sidebar_toggle"><i class="fa-regular fa-square-caret-right"></i></div><nav class="toc-nav"><ol class="list-unstyled"><li class="toc-level-1"><a href="#coding-with-pizza-in-2024.html">Coding with Pizza in 2024</a></li><li class="toc-level-2"><a href="#context">Context</a></li><li class="toc-level-2"><a href="#example">Example</a></li><li class="toc-level-2"><a href="#programming-archeology-or-how-do-we-run-this">Programming archeology, or how do we run this?</a></li><li class="toc-level-2"><a href="#comparing-to-todays-languages">Comparing to today's languages</a></li><li class="toc-level-3"><a href="#tooling">Tooling?</a></li><li class="toc-level-3"><a href="#generic-methods">generic methods.</a></li><li class="toc-level-3"><a href="#algebraic-data-types">Algebraic data types</a></li><li class="toc-level-3"><a href="#type-erasure">Type erasure</a></li><li class="toc-level-3"><a href="#pattern-matching">Pattern matching</a></li></ol></nav></div></div><div class="col-lg-8"><div class="jumbotron bg-light py-lg-5 py-3"><article><h1 id="coding-with-pizza-in-2024.html" class="display-5 anchor-link__source">Coding with Pizza in 2024</h1><ul class="list-inline mb-2"><li class="list-inline-item"><small><span class="text-muted">Saturday, 9 November 2024</span></small></li><li class="list-inline-item"><small><i class="fa-solid fa-hourglass-start"></i> 5 minute read</small></li><li class="list-inline-item"><small><a href="/articles/"><i class="fa-solid fa-angle-up"></i> all articles</a></small></li></ul><hr /><div class="container mb-2"><div class="row"><div class="col d-flex"><small><a href="/articles/the-case-for-operation-mirrors.html"><i class="fa-solid fa-angle-left"></i> Just declare your services: Introducing operation mirrors</a></small></div><div class="col d-flex flex-row-reverse"><small class="float-end"><a href="/articles/named-tuples.html">Scala's New Named Tuples: why you should embrace structural types <i class="fa-solid fa-angle-right"></i></a></small></div></div></div><div><p>The <a href="https://pizzacompiler.sourceforge.net">Pizza language</a> developed by Martin Odersky, and Philip Wadler in 1997 was quite a significant milestone in the history of Java and other JVM languages like Scala. As a research project, it introduced generics, lambdas, algebraic data types and pattern matching on top of Java, all in the 90s. Given that Java has finally introduced all of these features, and in the interests of preservation, can we run it today? is it useful?</p>
<h2><a href="#context" id="context" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Context</h2>
<p>At <a href="https://scala.io">Scala.IO 2024</a> I was inspired by a talk by Alexis Hernandez on running some Scala 2.7.7 code, to dive into earlier versions of Scala and their history, and sat in a corner with one goal: run hello world with Pizza - it took a minor journey but here is the result.</p>
<h2><a href="#example" id="example" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Example</h2>
<p>Here is the code I will compile, it is valid Pizza 1.1 code:</p>
<pre><code class="language-java">public class Option&lt;T&gt; {
  case Some(T value);
  case None;

  void foreach((T) -&gt; void action) {
    switch (this) {
      case Some(T foo):
        action(foo);
        break;
      case None:
        break;
    }
  }
}

public class Hello {
  static &lt;T&gt; void doPrint(T that, (T) -&gt; String show) {
    System.out.println(show(that));
  }

  static void doPrintInt(int that) {
    doPrint(that, fun(int i) -&gt; String {
      return String.valueOf(i);
    });
  }

  public static void main(String[] args) {
    Option&lt;int&gt; opt = new Option.Some(23);
    opt.foreach(doPrintInt);
  }
}
</code></pre>
<h2><a href="#programming-archeology-or-how-do-we-run-this" id="programming-archeology-or-how-do-we-run-this" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Programming archeology, or how do we run this?</h2>
<p>I downloaded the Pizza jar from Sourceforge, and failed to run it on JDK 21 (with macOS Sequoia) - predictably it failed to run with this exception:</p>
<pre><code>java -jar pizza-1.1.jar hello.pizza
hello.pizza:1: error while loading class java.lang.Object: java.io.IOException: file java/lang/Object.class not found
public class Option&lt;T&gt; {
       ^
hello.pizza:15: class String not found in class Option&lt;T&gt;
  static void doPrint(String that) {
                      ^
hello.pizza:19: class String not found in class Option&lt;T&gt;
  public static void main(String[] args) {
                          ^
hello.pizza:16: cannot access class out; file System/out.class not found
    System.out.println(that);
           ^
hello.pizza:21: variable String not found in class Option&lt;T&gt;
    opt.foreach(fun(int i) -&gt; void { doPrint(String.valueOf(i)); } );
                                             ^


An exception has occurred in the compiler. (v1.0g)
Please file a bug report at Sourceforge.net:
http://sourceforge.net/tracker/?group_id=31504&amp;atid=402238

   Thank you.

Exception in thread &quot;main&quot; java.lang.NullPointerException: Cannot invoke &quot;net.sf.pizzacompiler.compiler.Scope.lookup(net.sf.pizzacompiler.compiler.Name)&quot; because the return value of &quot;net.sf.pizzacompiler.compiler.TypeSymbol.locals()&quot; is null
	at net.sf.pizzacompiler.compiler.Namer.findMethod(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Namer.pizza:306)
	at net.sf.pizzacompiler.compiler.Namer.resolveConstructor(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Namer.pizza:664)
	at net.sf.pizzacompiler.compiler.Attr.resolveConstructor(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:93)
	at net.sf.pizzacompiler.compiler.Attr.attribExpr(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:1472)
	at net.sf.pizzacompiler.compiler.Attr.attribExpr(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:1113)
	at net.sf.pizzacompiler.compiler.Attr.attribStat(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:692)
	at net.sf.pizzacompiler.compiler.Attr.attribStats(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:750)
	at net.sf.pizzacompiler.compiler.Attr.attribDef(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:472)
	at net.sf.pizzacompiler.compiler.Attr.attribDef(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:424)
	at net.sf.pizzacompiler.compiler.Attr.attribute(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Attr.pizza:355)
	at net.sf.pizzacompiler.compiler.Main.process(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Main.pizza:228)
	at net.sf.pizzacompiler.compiler.Main.compile(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Main.pizza:309)
	at net.sf.pizzacompiler.compiler.Main.main(C:\pizza\main\src\net\sf\pizzacompiler\compiler\Main.pizza:385)
</code></pre>
<p>Ok so perhaps my JDK is too new, so I switched to JDK 8. Of course, it still errors:</p>
<pre><code>java -jar pizza-1.1.jar hello.pizza
hello.pizza:21: error while loading class java.lang.CharSequence: java.io.IOException: bad class file (java.lang.RuntimeException: bad constant pool tag: 18 at 10)
    opt.foreach(fun(int i) -&gt; void { doPrint(String.valueOf(i)); } );
                                                    ^
1 error
</code></pre>
<p>Hmm 🤔, constant pool tag 18? well according to the <a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html">Class File Format</a>, that relates to InvokeDynamic, which was introduced in Java 7. The Pizza compiler isn't prepared to handle JRE classes built by Java 7!</p>
<p>This would mean having to install Java 6 or perhaps even earlier on macOS, which is not an easy feat. Prior to Java 7, Apple was the only vendor building Java for Mac, and currently there exists exactly one legitimate build: <code>1.6.0_65-b14-468</code> provided by <a href="https://support.apple.com/en-us/106384">Apple</a>.</p>
<p>At that link, you will get a <code>.dmg</code> file, which when mounted will list a <code>.pkg</code> installer, but we can skip running the installer, and just extract the JRE home directory:</p>
<pre><code class="language-shell">pkgutil --expand-full /Volumes/Java\ for\ macOS\ 2017-001/JavaForOSX.pkg \
  ~/Downloads/java6download
</code></pre>
<p>then inside the extracted <code>java6download</code> file, you can then browse within <code>Resources/JavaForOSX.pkg</code> (&quot;Show package contents&quot; if using Finder). From there you can find the JRE inside one of the nested folders.</p>
<p>you can move that to a preferred location, such as <code>/Library/Java/JavaVirtualMachines/1.6.0.jdk</code>.</p>
<p>You can even use <a href="https://sdkman.io">SDKMAN!</a> to install it as a java candidate so it is simple to switch:</p>
<pre><code class="language-shell">sdk install java 6-apple /Library/Java/JavaVirtualMachines/1.6.0.jdk
</code></pre>
<p>In the above command, I installed a java candidate called <code>6-apple</code>, referring to JDK 6, vendored by Apple.</p>
<p>and now finally, after switching to <code>6-apple</code> I can get that Pizza code to compile!</p>
<pre><code>sdk use java 6-apple

Using java version 6-apple in this shell.
</code></pre>
<pre><code class="language-shell">java -jar pizza-1.1.jar hello.pizza
[1]    47213 bus error  java -jar pizza-1.1.jar hello.pizza
</code></pre>
<p>It actually succeeded, mostly, (ignoring the occasional bus error or segmentation fault!)</p>
<p>So what classes were generated?</p>
<pre><code class="language-text">ls

Hello$$closures.class  Option$$closures.class Option.class
Hello.class            Option$Some.class      hello.pizza
</code></pre>
<p>now if I run the code it will print &quot;23&quot;!</p>
<pre><code class="language-shell">java -classpath pizza-1.1.jar:. Hello
23
</code></pre>
<h2><a href="#comparing-to-todays-languages" id="comparing-to-todays-languages" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Comparing to today's languages</h2>
<p>If you squint your eyes, you might think this is not so far from Java 21 perhaps, could you build anything useful with it's abstractions?</p>
<h3><a href="#tooling" id="tooling" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Tooling?</h3>
<p>First of all, there is no build-tool or IDE support for Pizza (understandable).</p>
<h3><a href="#generic-methods" id="generic-methods" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>generic methods.</h3>
<p>The type parameters in Pizza can be defined on both methods and classes.</p>
<p>Here is the <code>identity</code> function in Pizza, which looks like the same syntax made it directly to Java:</p>
<pre><code class="language-java">&lt;R&gt; R identity(R that) {
  return that;
}
</code></pre>
<h3><a href="#algebraic-data-types" id="algebraic-data-types" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Algebraic data types</h3>
<p>24 years later in 2021, Scala 3 launched with it's enum feature, at the source level it looks very similar:</p>
<pre><code class="language-scala">enum Option[T] {
  case Some(value: T)
  case None
}
</code></pre>
<p>Of course Scala 2 from the initial release could encode the same algebraic data type, but more verbosely via sealed trait and case classes/objects.</p>
<h3><a href="#type-erasure" id="type-erasure" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Type erasure</h3>
<p>Like Java and Scala, generic type parameters are erased at runtime.</p>
<h3><a href="#pattern-matching" id="pattern-matching" class="anchor-link anchor-link__source"><i class="fa-solid fa-link"></i></a>Pattern matching</h3>
<p>In Pizza, pattern matching is added on top of the old Java switch statement,
could this mean that the fallthrough semantics still occur? Well actually no, the compiler will error:</p>
<pre><code class="language-java">  case Some(T foo): // error: possible fall-through from Pizza case
    action(foo);
  case None:
    System.out.println(&quot;ooops&quot;);
    break;
</code></pre>
<p>It seems inconvenient to still require to put <code>break</code> explicitly (perhaps this was kept because switch is still a statement in Pizza).</p>
</div><div class="container mb-2"><div class="row"><div class="col d-flex"><small><a href="/articles/the-case-for-operation-mirrors.html"><i class="fa-solid fa-angle-left"></i> Just declare your services: Introducing operation mirrors</a></small></div><div class="col d-flex flex-row-reverse"><small class="float-end"><a href="/articles/named-tuples.html">Scala's New Named Tuples: why you should embrace structural types <i class="fa-solid fa-angle-right"></i></a></small></div></div></div></article></div></div></div></div><footer class="mt-auto"><div class="footer-copyright text-center py-3"><small>© 2025 Jamie Thompson.<span class="text-muted"> Last published 20/Aug/2025</span></small></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script><script src="/static/js/nav-toc_50380f89e0ac8b1f7a353e494026d8dd.js" type="text/javascript"></script><script src="/static/js/sidebar-mobile_63c21c40d63ae89bd8880d2e1b3dc2c9.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js" type="text/javascript"></script><script src="/static/js/hljs-scala3_868eb64187ff110dc72ccc6085774ee9.js" type="text/javascript"></script><script src="/static/js/hljs_a6372cedaa54e6ef1cd502062aef22a1.js" type="text/javascript"></script><script src="/static/js/katex-render_ea5696b3297f767be055588a9afda5ce.js" type="text/javascript"></script><script src="/static/js/admonition_70fb98d2c3c7311ff9783fd7412c7132.js" type="text/javascript"></script></body></html>